# Dehydration 模组开发文档 - Maven 集成版

## 项目概述

**Dehydration** 是一个 Minecraft Fabric 1.20 模组，由 Globox_Z 开发。该模组为游戏添加了真实的脱水机制，让玩家需要管理自己的水分摄入。

- **模组 ID**: `dehydration`
- **作者**: Globox_Z
- **许可证**: GPLv3
- **CurseForge**: https://www.curseforge.com/minecraft/mc-mods/dehydration
- **CurseForge Project ID**: 410830
- **GitHub**: https://github.com/Globox1997/Dehydration

---

## 一、将 Dehydration 作为 Maven 库集成

### 1.1 使用 Curse Maven（推荐）

#### 步骤 1：添加 Maven 仓库

在你的 `build.gradle` 文件中添加 Curse Maven 仓库：

```groovy
repositories {
    // 其他仓库...
    
    // 添加 Curse Maven
    maven {
        url "https://cursemaven.com"
        content {
            includeGroup "curse.maven"
        }
    }
}
```

#### 步骤 2：添加 Dehydration 依赖

在 `build.gradle` 的 `dependencies` 部分添加：

```groovy
dependencies {
    // Minecraft 和 Fabric 依赖
    minecraft "com.mojang:minecraft:${project.minecraft_version}"
    mappings "net.fabricmc:yarn:${project.yarn_mappings}:v2"
    modImplementation "net.fabricmc:fabric-loader:${project.loader_version}"
    modImplementation "net.fabricmc.fabric-api:fabric-api:${project.fabric_version}"
    
    // Dehydration 依赖
    // Project ID: 410830
    // 替换 <file-id> 为你想要使用的具体版本的文件 ID
    modImplementation "curse.maven:dehydration-410830:<file-id>"
}
```

#### 步骤 3：在 fabric.mod.json 中声明依赖

```json
{
  "schemaVersion": 1,
  "id": "yourmodid",
  "version": "1.0.0",
  "name": "你的模组",
  "depends": {
    "fabricloader": ">=0.14.0",
    "fabric-api": "*",
    "minecraft": "~1.20",
    "java": ">=17",
    "dehydration": ">=x.y.z"
  }
}
```

### 1.2 如何获取 File ID

1. 访问 Dehydration 的 CurseForge 页面：https://www.curseforge.com/minecraft/mc-mods/dehydration/files
2. 点击你想要使用的版本
3. 在 URL 中找到文件 ID，例如：`https://www.curseforge.com/minecraft/mc-mods/dehydration/files/1234567` 中的 `1234567`

---

## 二、主要 API 使用

### 2.1 检测 Dehydration 是否加载

```java
import net.fabricmc.loader.api.FabricLoader;

public class DehydrationCompat {
    public static final boolean DEHYDRATION_LOADED = FabricLoader.getInstance().isModLoaded("dehydration");
    
    public static void doSomething() {
        if (DEHYDRATION_LOADED) {
            // Dehydration 已加载，可以使用其 API
        } else {
            // Dehydration 未加载，使用备用方案
        }
    }
}
```

### 2.2 访问玩家水分数据（需要完整源码）

**注意**：以下代码需要 Dehydration 的完整 Java 源代码才能编译。如果无法访问源码，请使用 JSON 配置方式（见第三章）。

```java
import net.dehydration.access.ThirstManagerAccess;
import net.dehydration.thirst.ThirstManager;
import net.minecraft.entity.player.PlayerEntity;

public class ThirstUtil {
    /**
     * 获取玩家的当前水分值
     */
    public static int getThirstLevel(PlayerEntity player) {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return 20; // 默认值
        }
        
        ThirstManager thirstManager = ((ThirstManagerAccess) player).getThirstManager();
        return thirstManager.getThirstLevel();
    }
    
    /**
     * 获取玩家的水分饱和度
     */
    public static float getThirstSaturation(PlayerEntity player) {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return 5.0f; // 默认值
        }
        
        ThirstManager thirstManager = ((ThirstManagerAccess) player).getThirstManager();
        return thirstManager.getThirstSaturation();
    }
    
    /**
     * 补充玩家水分
     */
    public static void addThirst(PlayerEntity player, int hydration, float potency) {
        if (!DehydrationCompat.DEHYDRATION_LOADED || player.world.isClient) {
            return;
        }
        
        ThirstManager thirstManager = ((ThirstManagerAccess) player).getThirstManager();
        thirstManager.addThirst(hydration, potency);
    }
    
    /**
     * 设置玩家的水分值
     */
    public static void setThirstLevel(PlayerEntity player, int level) {
        if (!DehydrationCompat.DEHYDRATION_LOADED || player.world.isClient) {
            return;
        }
        
        ThirstManager thirstManager = ((ThirstManagerAccess) player).getThirstManager();
        thirstManager.setThirstLevel(level);
    }
}
```

### 2.3 访问配置

```java
import net.dehydration.DehydrationMain;
import net.dehydration.config.DehydrationConfig;

public class ConfigAccess {
    public static DehydrationConfig getConfig() {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return null;
        }
        return DehydrationMain.CONFIG;
    }
    
    public static float getThirstDamage() {
        DehydrationConfig config = getConfig();
        return config != null ? config.thirst_damage : 1.0f;
    }
    
    public static boolean isPotionThirstQuenchEnabled() {
        DehydrationConfig config = getConfig();
        return config != null ? config.potion_thirst_quench : true;
    }
}
```

### 2.4 使用物品标签

```java
import net.dehydration.tag.DehydrationTags;
import net.minecraft.item.ItemStack;

public class TagCheck {
    public static boolean isHydratingDrink(ItemStack stack) {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return false;
        }
        return stack.isIn(DehydrationTags.Items.HYDRATING_DRINKS);
    }
    
    public static boolean isHydratingFood(ItemStack stack) {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return false;
        }
        return stack.isIn(DehydrationTags.Items.HYDRATING_FOOD);
    }
    
    public static boolean isStrongerHydratingDrink(ItemStack stack) {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return false;
        }
        return stack.isIn(DehydrationTags.Items.STRONGER_HYDRATING_DRINKS);
    }
}
```

### 2.5 访问状态效果

```java
import net.dehydration.effect.DehydrationEffects;
import net.minecraft.entity.LivingEntity;
import net.minecraft.entity.effect.StatusEffectInstance;

public class EffectUtil {
    public static void applyThirstEffect(LivingEntity entity, int duration, int amplifier) {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return;
        }
        entity.addStatusEffect(new StatusEffectInstance(
            DehydrationEffects.THIRST_EFFECT,
            duration,
            amplifier
        ));
    }
    
    public static void applyHydrationEffect(LivingEntity entity, int duration, int amplifier) {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return;
        }
        entity.addStatusEffect(new StatusEffectInstance(
            DehydrationEffects.HYDRATION_EFFECT,
            duration,
            amplifier
        ));
    }
}
```

### 2.6 访问方块和物品

```java
import net.dehydration.block.DehydrationBlocks;
import net.dehydration.item.DehydrationItems;
import net.minecraft.block.Block;
import net.minecraft.item.Item;

public class ContentAccess {
    public static Block getBambooPump() {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return null;
        }
        return DehydrationBlocks.BAMBOO_PUMP;
    }
    
    public static Block getCampfireCauldron() {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return null;
        }
        return DehydrationBlocks.CAMPFIRE_CAULDRON;
    }
    
    public static Block getCopperCauldron() {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return null;
        }
        return DehydrationBlocks.COPPER_CAULDRON;
    }
    
    public static Item getLeatherFlask() {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return null;
        }
        return DehydrationItems.LEATHER_FLASK;
    }
    
    public static Item getIronLeatherFlask() {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return null;
        }
        return DehydrationItems.IRON_LEATHER_FLASK;
    }
    
    public static Item getWaterBowl() {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return null;
        }
        return DehydrationItems.WATER_BOWL;
    }
    
    public static Item getPurifiedWaterBucket() {
        if (!DehydrationCompat.DEHYDRATION_LOADED) {
            return null;
        }
        return DehydrationItems.PURIFIED_WATER_BUCKET;
    }
}
```

---

## 三、使用 JSON 配置添加补水物品（推荐）

**这是最简单、最稳定的方式，不需要访问 Java 源代码！**

### 3.1 创建目录结构

在你的模组中创建以下目录：

```
src/main/resources/
└── data/
    └── dehydration/
        ├── hydration_items/
        │   └── yourmod_items.json
        └── tags/
            └── items/
                ├── hydrating_drinks.json
                └── hydrating_food.json
```

### 3.2 配置补水物品

创建 `src/main/resources/data/dehydration/hydration_items/yourmod_items.json`：

```json
{
  "yourmodid:your_drink_item": {
    "hydration": 5,
    "potency": 1.0
  },
  "yourmodid:your_food_item": {
    "hydration": 2,
    "potency": 0.5
  },
  "yourmodid:super_drink": {
    "hydration": 10,
    "potency": 1.5
  }
}
```

### 3.3 添加物品标签

创建 `src/main/resources/data/dehydration/tags/items/hydrating_drinks.json`：

```json
{
  "values": [
    "yourmodid:your_drink_item",
    "yourmodid:super_drink"
  ]
}
```

创建 `src/main/resources/data/dehydration/tags/items/hydrating_food.json`：

```json
{
  "values": [
    "yourmodid:your_food_item"
  ]
}
```

---

## 四、完整示例：创建自定义补水物品

### 4.1 物品类（兼容模式）

```java
package com.yourmodid.item;

import com.yourmodid.DehydrationCompat;
import net.fabricmc.fabric.api.item.v1.FabricItemSettings;
import net.minecraft.entity.LivingEntity;
import net.minecraft.entity.player.PlayerEntity;
import net.minecraft.item.Item;
import net.minecraft.item.ItemStack;
import net.minecraft.world.World;

public class CustomDrinkItem extends Item {
    private final int hydration;
    private final float potency;

    public CustomDrinkItem(int hydration, float potency) {
        super(new FabricItemSettings().maxCount(16));
        this.hydration = hydration;
        this.potency = potency;
    }

    @Override
    public ItemStack finishUsing(ItemStack stack, World world, LivingEntity user) {
        ItemStack result = super.finishUsing(stack, world, user);
        
        // 如果 Dehydration 已加载，使用 JSON 配置自动处理
        // 如果需要手动处理，可以使用反射（不推荐）
        
        return result;
    }
}
```

### 4.2 注册物品

```java
package com.yourmodid;

import com.yourmodid.item.CustomDrinkItem;
import net.fabricmc.api.ModInitializer;
import net.fabricmc.fabric.api.itemgroup.v1.ItemGroupEvents;
import net.minecraft.item.Item;
import net.minecraft.item.ItemGroups;
import net.minecraft.registry.Registries;
import net.minecraft.registry.Registry;
import net.minecraft.util.Identifier;

public class YourMod implements ModInitializer {
    public static final String MOD_ID = "yourmodid";
    
    public static final Item CUSTOM_DRINK = new CustomDrinkItem(6, 1.2f);
    public static final Item CUSTOM_FOOD = new CustomDrinkItem(3, 0.6f);

    @Override
    public void onInitialize() {
        // 注册物品
        Registry.register(Registries.ITEM, new Identifier(MOD_ID, "custom_drink"), CUSTOM_DRINK);
        Registry.register(Registries.ITEM, new Identifier(MOD_ID, "custom_food"), CUSTOM_FOOD);
        
        // 添加到物品组
        ItemGroupEvents.modifyEntriesEvent(ItemGroups.FOOD_AND_DRINK).register(content -> {
            content.add(CUSTOM_DRINK);
            content.add(CUSTOM_FOOD);
        });
    }
}
```

---

## 五、配置选项参考

| 配置项 | 说明 |
|--------|------|
| `thirst_damage` | 口渴伤害 |
| `potion_thirst_quench` | 药水解渴 |
| `milk_thirst_quench` | 牛奶桶解渴 |
| `flask_thirst_quench` | 水壶解渴 |
| `stew_thirst_quench` | 炖菜解渴 |
| `food_thirst_quench` | 食物解渴 |
| `drinks_thirst_quench` | 饮料解渴 |
| `stronger_stew_thirst_quench` | 更强的炖菜解渴 |
| `stronger_food_thirst_quench` | 更强的食物解渴 |
| `stronger_drinks_thirst_quench` | 更强的饮料解渴 |
| `water_souce_quench` | 水源解渴 |
| `water_bowl_quench` | 水碗解渴 |
| `hydrating_factor` | 口渴系数 |
| `sleep_thirst_consumption` | 睡眠水分消耗 |
| `sleep_hunger_consumption` | 睡眠饥饿消耗 |
| `potion_bad_thirst_chance` | 负面药水口渴几率 |
| `potion_bad_thirst_duration` | 负面药水口渴持续时间 |
| `milk_thirst_chance` | 牛奶口渴减益几率 |
| `water_bowl_thirst_chance` | 水碗口渴几率 |
| `water_sip_thirst_chance` | 用手舀水喝口渴几率 |
| `water_sip_thirst_duration` | 用手舀水喝口渴持续时间 |
| `other_droplet_texture` | 其他水分值材质 |
| `thirst_effect_factor` | 口渴影响系数 |
| `flask_dirty_thirst_chance` | 脏水壶口渴机会 |
| `flask_dirty_thirst_duration` | 脏水壶口渴持续时间 |
| `water_boiling_time` | 水沸腾时间 |
| `harder_nether` | 更难的下界 |
| `nether_factor` | 下界水分消耗系数 |
| `hud_x` | Hud X 坐标 |
| `hud_y` | Hud Y 坐标 |
| `allow_non_flowing_water_sip` | 允许用手舀不流动的水喝 |
| `honey_quench` | 蜂蜜解渴 |
| `pump_cooldown` | 竹泵冷却时间 |
| `pump_requires_water` | 竹泵需要有水 |
| `bottle_consumes_source_block` | 瓶子可以装完水源方块 |
| `special_effects` | 特殊效果 |
| `thirst_preview` | 补充的水分值预览 |

---

## 六、最佳实践

### 6.1 始终检查 Dehydration 是否加载

```java
import net.fabricmc.loader.api.FabricLoader;

public class DehydrationCompat {
    public static final boolean DEHYDRATION_LOADED = FabricLoader.getInstance().isModLoaded("dehydration");
    
    public static <T> T getIfLoaded(java.util.function.Supplier<T> supplier, T defaultValue) {
        if (DEHYDRATION_LOADED) {
            try {
                return supplier.get();
            } catch (Exception e) {
                return defaultValue;
            }
        }
        return defaultValue;
    }
}
```

### 6.2 优先使用 JSON 配置

- JSON 配置更简单、更稳定
- 不需要访问 Java 源代码
- 即使 Dehydration 更新也不会影响你的代码
- 是 Dehydration 官方推荐的方式

### 6.3 安全的反射调用（仅在必要时使用）

```java
import java.lang.reflect.Method;

public class ReflectionUtil {
    private static Method thirstManagerMethod = null;
    private static Method getThirstLevelMethod = null;
    private static Method addThirstMethod = null;
    
    static {
        try {
            if (DehydrationCompat.DEHYDRATION_LOADED) {
                Class<?> accessClass = Class.forName("net.dehydration.access.ThirstManagerAccess");
                thirstManagerMethod = accessClass.getMethod("getThirstManager");
                
                Class<?> managerClass = Class.forName("net.dehydration.thirst.ThirstManager");
                getThirstLevelMethod = managerClass.getMethod("getThirstLevel");
                addThirstMethod = managerClass.getMethod("addThirst", int.class, float.class);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    public static int getThirstLevel(Object player) {
        if (thirstManagerMethod == null || getThirstLevelMethod == null) {
            return 20;
        }
        try {
            Object manager = thirstManagerMethod.invoke(player);
            return (int) getThirstLevelMethod.invoke(manager);
        } catch (Exception e) {
            return 20;
        }
    }
}
```

---

## 七、当前代码库状态说明

**重要提示**：
- 当前代码库（`d:\Projects\mcmod\Dehydration-1.20`）**仅包含资源文件**
- 缺少完整的 Java 源代码
- 如果需要访问 Java API，请从官方 GitHub 仓库获取完整代码

### 获取完整源代码

1. 访问：https://github.com/Globox1997/Dehydration
2. 点击 "Code" → "Download ZIP"
3. 解压到你的项目目录

---

## 八、相关链接

- **Curse Maven 官网**: https://cursemaven.com/
- **Dehydration CurseForge**: https://www.curseforge.com/minecraft/mc-mods/dehydration
- **Dehydration GitHub**: https://github.com/Globox1997/Dehydration
- **作者 Wiki**: https://globoxwiki.com/
- **Fabric 文档**: https://fabricmc.net/wiki/

---

## 许可证

本项目采用 GPLv3 许可证。

---

**文档版本**: 2.0  
**最后更新**: 2026-02-21
